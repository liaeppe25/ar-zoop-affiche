<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Affiche</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>

  <style> body { margin: 0; overflow: hidden; } </style>
</head>
<body>
  <a-scene
    mindar-image="imageTargetSrc: targets.mind;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true"
    renderer="colorManagement: true; physicallyCorrectLights: true"
  renderer="logarithmicDepthBuffer: true;"
  shadow="type: pcfsoft"
>
  >
    <!-- Assets -->
    <a-assets>
      <a-asset-item id="afficheModel" src="affiche.glb" crossorigin="anonymous"></a-asset-item>
    </a-assets>

    <!-- Caméra -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Lumières (ajuste les intensités si nécessaire) -->
    <a-light type="ambient" intensity="2.5"></a-light>
    <a-light type="directional" position="1 2 1" intensity="1.2"castShadow="true"
  shadowMapHeight="1024"
  shadowMapWidth="1024"></a-light>

    <!-- TARGET (index 0) -->
    <a-entity mindar-image-target="targetIndex: 0" id="targetAffiche">

      <!-- Parent (pas de rotation continue) ; sert de pivot et d'orientation -->
      <a-entity id="afficheParent" position="0 0 0">

       <!-- Modèle 3D -->
<a-entity
  id="affiche"
  gltf-model="#afficheModel"
  position="0 0 0"
  scale="0.7 0.7 0.7"
  visible="false"
  shadow="cast: true; receive: false"

  material="transparent: true; opacity: 0"

  animation__move="property: position;
                   from: 0 0 -0.5;
                   to: 0 0 0;
                   dur: 600;
                   easing: easeOutCubic;
                   startEvents: start-animation"

  animation__scale="property: scale;
                    from: 0.3 0.3 0.3;
                    to: 1 1 1;
                    dur: 800;
                    easing: easeOutElastic;
                    startEvents: start-animation">
</a-entity>


    </a-entity>
  </a-scene>

  <!-- Script pour déclencher l'animation et pour réinitialiser à la perte de cible -->
  <script>
    const target = document.querySelector('#targetAffiche');
    const model = document.querySelector('#affiche');
    const initial = {
      position: { x: 0, y: 0, z: 0 },
      scale: { x: 0.6, y: 0.6, z: 0.6 }
    };

    // helper: reset attributes (useful when targetLost)
    function resetModel() {
      model.setAttribute('position', `${initial.position.x} ${initial.position.y} ${initial.position.z}`);
      model.setAttribute('scale', `${initial.scale.x} ${initial.scale.y} ${initial.scale.z}`);
      model.setAttribute('visible', 'false');
    }

    // quand la cible est détectée : afficher + lancer l'entrée
    target.addEventListener('targetFound', () => {
      model.setAttribute('visible', 'true');
      // déclenche toutes les animations qui ont startEvents: start-animation
      model.emit('start-animation');
    });

    // quand la cible est perdue : cacher et reset pour que la prochaine détection reparte de zéro
    target.addEventListener('targetLost', () => {
      // stop any floating loop by hiding and resetting attributes
      resetModel();
    });

    // assure l'état initial au chargement
    resetModel();
  </script>
</body>
</html>